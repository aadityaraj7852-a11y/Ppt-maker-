<!doctype html>
<html lang="hi">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">

<title>MCQ → PPTX (Kalam + Colors + Bold + Margins)</title>

<!-- Kalam font -->
<link href="https://fonts.googleapis.com/css2?family=Kalam&display=swap" rel="stylesheet">

<!-- PPTX Library -->
<script src="https://cdn.jsdelivr.net/npm/pptxgenjs@3.9.0/dist/pptxgen.bundle.min.js"></script>

<style>
body{font-family:'Kalam',cursive;background:#0f1720;color:#eee;margin:16px}
.card{background:#121926;padding:16px;border-radius:10px;border:1px solid #223;max-width:1150px;margin:auto}
label{color:#9fb7ff;font-weight:700;margin-top:8px;display:block}
textarea,input{width:100%;padding:8px;border-radius:6px;border:1px solid #334;background:#0b1220;color:#fff;font-family:'Kalam',cursive}
.btn{padding:8px 12px;border:none;border-radius:8px;margin-top:10px;cursor:pointer;font-family:'Kalam',cursive;font-weight:700}
.btn-blue{background:#0b74ff;color:#fff}
.btn-grey{background:#333;color:#ccd}
.btn-red{background:#e11d48;color:#fff}

.row{display:flex;gap:14px;flex-wrap:wrap}
.col{flex:1;min-width:300px}

.preview{background:#071019;border:1px solid #203040;margin-top:10px;
         border-radius:8px;padding:12px;max-height:500px;overflow:auto}
.slide-box{background:#000;color:#fff;padding:8px;border-radius:6px;margin-bottom:10px}
.slide-block{white-space:pre-line;font-size:18px;line-height:1.05}
.slide-block[contenteditable="true"]{outline:1px dashed #666;border-radius:4px;padding:6px}
</style>
</head>

<body>
<div class="card">

<h2 style="color:#fff">MCQ → PPTX (Kalam + Colors + Bold Q + No Gap + Margins)</h2>

<div class="row">

<!-- LEFT PANEL -->
<div class="col">

<label>JSON Input</label>
<textarea id="jsonData" rows="8"></textarea>

<h3 style="color:#fff;margin-top:10px">Manual Entry</h3>

<label>Question</label>
<textarea id="qInput" rows="2"></textarea>

<label>Options (4)</label>
<input id="o1" placeholder="Option 1">
<input id="o2" placeholder="Option 2">
<input id="o3" placeholder="Option 3">
<input id="o4" placeholder="Option 4">

<button class="btn btn-grey" id="addBtn">Add Question</button>

<label>Background Image (optional)</label>
<input type="file" id="bgImg" accept="image/*">

<div class="row">
  <div class="col">
    <label>Slide Width (px)</label>
    <input id="wPx" value="1280">
  </div>
  <div class="col">
    <label>Slide Height (px)</label>
    <input id="hPx" value="720">
  </div>
</div>

<div class="row">
  <div class="col">
    <label>Top Margin (px)</label>
    <input id="topM" value="20">
  </div>
  <div class="col">
    <label>Left Margin (px)</label>
    <input id="leftM" value="20">
  </div>
</div>

<div class="row">
  <div class="col">
    <label>Question Color</label>
    <input type="color" id="qColor" value="#ffffff">
  </div>
  <div class="col">
    <label>Option Color</label>
    <input type="color" id="oColor" value="#ffffff">
  </div>
</div>

<button id="importBtn" class="btn btn-grey">Import JSON</button>
<button id="makeBtn" class="btn btn-blue">Generate PPTX</button>
<button id="clrBtn" class="btn btn-red">Clear All</button>

</div>

<!-- RIGHT PANEL -->
<div class="col">

<label>Preview (editable)</label>
<div id="preview" class="preview">
  <div style="color:#7aa">Preview दिखाई देगा…</div>
</div>

</div>
</div>
</div>

<script>
const $=id=>document.getElementById(id);
let DATA=[];
let BG=null;

/* File → Base64 */
function fileToURL(f){return new Promise(res=>{let r=new FileReader();r.onload=()=>res(r.result);r.readAsDataURL(f);});}

/* Normalize */
function norm(x){
 return {
   question:(x.question||"").replace(/\\n/g,"\n"),
   option:(x.option||["","","",""]).slice(0,4).map(o=>o.replace(/\\n/g,"\n"))
 };
}

/* Preview Render */
function render(){
 let box=$("preview");
 box.innerHTML="";
 if(DATA.length===0){box.innerHTML="<div style='color:#7aa'>No questions.</div>";return;}

 DATA.forEach((q,i)=>{
   let wrap=document.createElement("div");
   wrap.className="slide-box";

   let blk=document.createElement("div");
   blk.className="slide-block";
   blk.contentEditable="true";

   blk.innerText=
     `Q${i+1}. ${q.question}\n`+
     `1. ${q.option[0]}\n`+
     `2. ${q.option[1]}\n`+
     `3. ${q.option[2]}\n`+
     `4. ${q.option[3]}`;

   blk.addEventListener("blur",()=>{
     DATA[i]=parseBlock(blk.innerText);
     render();
   });

   wrap.appendChild(blk);
   box.appendChild(wrap);
 });
}

function parseBlock(t){
 let L=t.split("\n").map(s=>s.trim()).filter(Boolean);
 let Q=L[0].replace(/^[Qq]\d+\.\s*/,"");
 let O=[];
 for(let i=1;i<L.length && O.length<4;i++)
   O.push(L[i].replace(/^\d+\.\s*/,""));
 while(O.length<4) O.push("");
 return norm({question:Q, option:O});
}

/* Import JSON */
$("importBtn").onclick=()=>{
 try{
   let j=JSON.parse($("jsonData").value);
   if(!Array.isArray(j)) j=[j];
   DATA=j.map(norm);
   render();
 }catch(e){alert("Invalid JSON");}
};

/* Add Manual */
$("addBtn").onclick=()=>{
 let q=$("qInput").value.trim();
 if(!q) return alert("Question empty");
 DATA.push(norm({question:q,option:[$("o1").value,$("o2").value,$("o3").value,$("o4").value]}));
 $("qInput").value=$("o1").value=$("o2").value=$("o3").value=$("o4").value="";
 render();
};

/* BG Upload */
$("bgImg").onchange=async e=>{
 let f=e.target.files[0];
 if(!f) return;
 BG=await fileToURL(f);
};

/* Sync Preview */
function syncPrev(){
 document.querySelectorAll(".slide-block").forEach((blk,i)=>{
   DATA[i]=parseBlock(blk.innerText);
 });
}

/* Wrap long text */
function wrapText(ctx, txt, x, y, maxW, lh){
 let words=txt.split(" ");
 let line="";
 for(let w of words){
   let test=line+w+" ";
   if(ctx.measureText(test).width>maxW){
     ctx.fillText(line,x,y);
     y+=lh;
     line=w+" ";
   }else line=test;
 }
 ctx.fillText(line,x,y);
 return y+lh;
}

/* Render single slide → image */
async function canvasSlide(item,W,H,top,left,qc,oc){
 await document.fonts.load("30px Kalam");

 let c=document.createElement("canvas");
 c.width=W; c.height=H;
 let ctx=c.getContext("2d");

 if(BG){
   let im=new Image(); im.src=BG;
   await new Promise(r=>{im.onload=r;});
   ctx.drawImage(im,0,0,W,H);
 } else {
   ctx.fillStyle="#000"; ctx.fillRect(0,0,W,H);
 }

 let qF=Math.round(H*0.045);
 let oF=Math.round(H*0.038);

 ctx.textBaseline="top";

 /* QUESTION — BOLD */
 ctx.font=`bold ${qF}px Kalam`;
 ctx.fillStyle=qc;
 let y=top;

 for(let l of item.question.split("\n")){
   y=wrapText(ctx,l,left,y,W-left*2,qF+2);
 }

 /* OPTIONS — NOT BOLD */
 ctx.font=`${oF}px Kalam`;
 ctx.fillStyle=oc;

 for(let i=0;i<4;i++){
   let line=`${i+1}. ${item.option[i]}`;
   y=wrapText(ctx,line,left,y,W-left*2,oF+2);
 }

 return c.toDataURL("image/png");
}

/* px → inches */
function pxIn(px){return px/96;}

/* Generate PPT */
$("makeBtn").onclick=async()=>{

 if(!DATA.length) return alert("No questions");

 syncPrev();

 let W=parseInt($("wPx").value);
 let H=parseInt($("hPx").value);
 let top=parseInt($("topM").value);
 let left=parseInt($("leftM").value);
 let qc=$("qColor").value;
 let oc=$("oColor").value;

 let ppt=new PptxGenJS();
 ppt.defineLayout({name:"CUST",width:pxIn(W),height:pxIn(H)});
 ppt.layout="CUST";

 for(let item of DATA){
   let durl=await canvasSlide(item,W,H,top,left,qc,oc);
   let s=ppt.addSlide();
   s.addImage({data:durl,x:0,y:0,w:pxIn(W),h:pxIn(H)});
 }

 ppt.writeFile({fileName:"MCQ_Kalam_Final.pptx"});
};

/* Clear */
$("clrBtn").onclick=()=>{DATA=[];$("jsonData").value="";render();};

render();
</script>
</body>
</html>
