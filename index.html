
<!doctype html>
<html lang="hi">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>MCQ â†’ PPTX FINAL SAFE</title>

<link href="https://fonts.googleapis.com/css2?family=Kalam&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/pptxgenjs@3.9.0/dist/pptxgen.bundle.min.js"></script>

<style>
body{font-family:'Kalam',cursive;background:#0f1720;color:#eee;margin:16px}
.card{background:#121926;padding:16px;border-radius:10px;border:1px solid #223;max-width:1200px;margin:auto}
label{display:block;margin-top:8px;color:#9fb7ff;font-weight:700}
textarea,input{width:100%;padding:8px;border-radius:6px;border:1px solid #334;background:#0b1220;color:#fff}
.btn{padding:10px 14px;border:none;border-radius:8px;margin-top:10px;font-weight:700;cursor:pointer}
.btn-blue{background:#0b74ff;color:#fff}
.btn-grey{background:#333;color:#ccc}
.btn-red{background:#e11d48;color:#fff}
.row{display:flex;gap:12px;flex-wrap:wrap}
.col{flex:1;min-width:280px}

.preview{background:#071019;padding:12px;border-radius:8px;margin-top:10px;border:1px solid #203040;max-height:520px;overflow:auto}
.slide-preview{background:#000;color:#fff;padding:10px;border-radius:6px;margin-bottom:12px;position:relative}
.slide-preview .del{position:absolute;top:4px;right:6px;background:#e11d48;border:none;color:#fff;border-radius:50%;width:22px;height:22px;cursor:pointer}
.slide-preview .blk{white-space:pre-wrap;outline:1px dashed rgba(255,255,255,.15);padding:6px;border-radius:4px}
</style>
</head>

<body>
<div class="card">
<h2>MCQ â†’ PPTX (FINAL SAFE + EDITABLE)</h2>

<div class="row">
<div class="col">
<label>JSON Input</label>
<textarea id="jsonArea" rows="7"></textarea>

<label>Background Image (â‰¤ 8MB)</label>
<input type="file" id="bgImg" accept="image/*">

<label>Q Color</label>
<input type="color" id="qColor" value="#ffff00">

<label>Option Color</label>
<input type="color" id="optColor" value="#ffffff">

<button id="importBtn" class="btn btn-grey">Import JSON</button>
<button id="generateBtn" class="btn btn-blue">Generate PPTX</button>
<button id="clearBtn" class="btn btn-red">Clear</button>
</div>

<div class="col">
<label>Preview (Editable)</label>
<div id="preview" class="preview">No Questions</div>
</div>
</div>
</div>

<script>
const $=id=>document.getElementById(id);
let DATA=[], BG=null;

function normalize(x){
  return {
    question:(x.question||""),
    option:(x.option||["","","",""]).slice(0,4)
  };
}

function renderPreview(){
  const p=$("preview"); p.innerHTML="";
  if(DATA.length===0){p.innerText="No Questions";return;}
  DATA.forEach((q,i)=>{
    const w=document.createElement("div");
    w.className="slide-preview";

    const del=document.createElement("button");
    del.className="del"; del.innerText="Ã—";
    del.onclick=()=>{DATA.splice(i,1);renderPreview();};

    const blk=document.createElement("div");
    blk.className="blk"; blk.contentEditable="true";
    blk.innerText=
      `Q${i+1}. ${q.question}\n`+
      `1. ${q.option[0]}\n2. ${q.option[1]}\n3. ${q.option[2]}\n4. ${q.option[3]}`;

    blk.onblur=()=>{
      const lines=blk.innerText.split("\n");
      const ques=lines[0].replace(/^Q\d+\.\s*/,"");
      const opts=lines.slice(1,5).map(l=>l.replace(/^\d+\.\s*/,""));
      DATA[i]={question:ques,option:opts};
    };

    w.appendChild(del); w.appendChild(blk);
    p.appendChild(w);
  });
}

$("bgImg").onchange=e=>{
  const f=e.target.files[0];
  if(!f) return;
  if(f.size>8*1024*1024){alert("BG image à¤¬à¤¹à¥à¤¤ à¤¬à¤¡à¤¼à¥€ à¤¹à¥ˆ (8MB max)");return;}
  const r=new FileReader();
  r.onload=()=>BG=r.result;
  r.readAsDataURL(f);
};

$("importBtn").onclick=()=>{
  try{
    let j=JSON.parse($("jsonArea").value);
    if(!Array.isArray(j)) j=[j];
    DATA=j.map(normalize);
    renderPreview();
  }catch(e){alert("Invalid JSON");}
};

$("generateBtn").onclick=async()=>{
  if(DATA.length===0) return alert("No questions");

  const ppt=new PptxGenJS();
  ppt.defineLayout({name:"FIX",width:13.54,height:7.4});
  ppt.layout="FIX";

  const qc=$("qColor").value.replace("#","");
  const oc=$("optColor").value.replace("#","");

  for(let i=0;i<DATA.length;i++){
    const q=DATA[i];
    const s=ppt.addSlide();
    if(BG) s.background={data:BG};

    s.addText(`Q${i+1}. ${q.question}`,{
      x:0.7,y:0.6,w:12,fontSize:28,bold:true,color:qc,fontFace:"Kalam"
    });

    q.option.forEach((op,k)=>{
      s.addText(`${k+1}. ${op}`,{
        x:0.9,y:1.8+k*0.9,w:11,fontSize:24,color:oc,fontFace:"Kalam"
      });
    });

    // ðŸ”¥ throttle (browser ko saans)
    if(i%10===0) await new Promise(r=>setTimeout(r,0));
  }

  await ppt.writeFile({fileName:"MCQ_FINAL_SAFE.pptx"});
};

$("clearBtn").onclick=()=>{DATA=[];$("jsonArea").value="";renderPreview();};

renderPreview();
</script>
</body>
</html>
